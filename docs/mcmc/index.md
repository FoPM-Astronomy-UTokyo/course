# はじめに

この実習ではマルコフ連鎖モンテカルロ法 (Markov-Chain Monte Carlo; MCMC) をとりあつかいます. MCMC はある確率分布から, 確率変数を効率よくサンプルするための手法のひとつです. 任意の確率分布に従う乱数を生成するための手法と言い換えてもいいでしょう.

確率変数 $x$ が確率分布 $P(x)$ に従うとします[^1]. このことを以下のように表記します.

[^1]: このテキストでは様々な確率分布が出てくることが予想されるので, その都度新しい記号をあてていると文字が枯渇してしまいます. そこで確率変数 $x$ の確率分布を $P(x)$ と表記します. 確率変数 $Y$ の確率分布は $P(Y)$ です. 文字は同じでも引数が変われば違う確率分布関数を表していると解釈してください. 例外は $P(x)$ と $P(x')$ です. これは同じ確率分布関数ですが $x$ と $x'$ という異なる値に対する確率の値を表していると解釈してください.

$$
x \sim P(x).
$$

$x$ は離散値でも連続でもいいのですが, ここでは便宜的に連続した値をとるとしましょう. $x$ を使って計算できる量 $A(x)$ の期待値は次のように書けます.

$$
\left\langle A(x) \right\rangle_{x \sim P(x)}
= \int\mathrm{d}x\,A(x)P(x).
$$

もし $x$ が多次元の量であれば右辺の積分は多次元空間での積分になります. 多次元での積分は一般に計算コストが高くなってしまいます. 一方で, 確率分布 $P(x)$ に従う確率変数の列 $\{x_i\}_{i=1{\ldots}n}$ を用いると, 右辺の積分を以下の和によって近似することができます.

$$
\int\mathrm{d}x\,A(x)P(x)
\simeq \frac{1}{n}\sum_{i=1}^{n} A(x_i).
$$

これによってあらゆる量 $A(x)$ の期待値をまったく同じ手続きで求めることができます. また, $x$ が離散的であっても連続であっても同じ手続きで計算をすることができます. もちろん, 確率分布 $P(x)$ に従う確率変数の列 $\{x_i\}_{i=1{\ldots}n}$ を効率よく生成する (確率分布 $P(x)$ からサンプルする) 手法があることが前提です. サンプルするための計算コストが積分を上回ってしまっては意味がありません. そして MCMC は低コストで確率分布 $P(x)$ に従う確率変数 $x$ をサンプルすることのできる強力な手法です. 特に高次元空間を対象としなければならない場合や, 確率分布関数を直接計算することが難しい場合に活躍します. 以下では, 何故 MCMC が必要になるのかといったところから始めて, Python で MCMC を動かすコードを書き, さまざまな問題に適用することを目指します.


## コンテンツ
1. [乱数生成 -- 逆関数法と棄却法](./generate_random_variables.md)
1. [静的なモンテカルロ法による計算](./static_monte_carlo.md)
1. [動的なモンテカルロ法 -- マルコフ連鎖によるサンプリング](./markov_chain.md)
1. [Metropolis-Hastings アルゴリズムによる MCMC 実践](./scratchbuild_mcmc.md)
1. [マルコフ連鎖の収束に関するあれこれ](./chain_convergence.md)
1. [演習問題: 線形回帰](./linear_regression.md)
1. [演習問題: 打ち切り回帰](./censored_regression.md)


## 動作環境
このテキストの内容は Python 3.7.1 をベースに作成されています. 使用しているパッケージは以下のとおりです. もしテキストに記載してあるコードが動かない場合は, パッケージのバージョンに差がないかをチェックしてみてください.

``` python
astropy==4.2
matplotlib==3.3.4
numpy==1.20.1
pandas==1.1.4
scipy==1.3.0
tqdm==4.59.0
```

もし, このテキストのコードが最新のバージョンで動かなかった場合には更新する必要があるので管理者までお知らせください.

*[MCMC]: Markov-Chain Monte Carlo
